### DNS 协议

DNS 协议提供的是一种主机名到 IP 地址的转换服务，就是我们常说的域名系统。它是一个由分层的 DNS 服务器组成的分布式数据库，是定义了主机如何查询这个分布式数据库的方式的应用层协议。DNS 协议运行在 UDP 协议之上，使用 53 号 端口。

www.qq.com. 来说，等等，是不是多打了一个点，当然不是多打，这个最后的 . 代表的是根域名，默认情况下所有的网址的最后一位都是 .，只不过为了方便用户，通常都会省略，浏览器在 DNS 解析 时会自动加上的，com 是顶级域名，qq 是二级域名，www 是三级域名，如果 www 前还有，那就四级等等

### DNS 解析步骤

系统会检查浏览器缓存中有没有这个域名对应的解析过的 IP 地址，如果缓存中有，这个解析过程就将结束。浏览器缓存是受这个域名的失效时间和缓存的空间大小控制的。

如果用户的浏览器缓存中没有，浏览器会查找操作系统缓存中即为本地的 Host 文件。

检查路由器缓存

如果前几步都没没找到，会向 ISP(网络服务提供商)的 LDNS(Local DNS) 服务器查询。比如你用的是电信的网络，则会进入电信的 DNS 缓存服务器中进行查找

如果 LDNS 服务器没找到，会向根域名服务器(Root Server)请求解析，分为以下几步：

- 根域名服务器收到请求后会查看区域文件记录，若无则将其管辖范围内顶级域名 ( .com ) 服务器 IP 告诉本地 DNS 服务器
- 顶级域名服务器收到请求后查看区域文件记录，若无则将其管辖范围内主域名（ qq.com ）服务器的 IP 地址告诉本地 DNS 服务器
- 主域名服务器接受到请求后查询自己的缓存，如果没有则进入下一级域名服务器（ www.qq.com ）进行查找，并重复该步骤直至找到正确纪录
- 本地域名服务器把返回的结果保存到缓存，以备下一次使用，同时将该结果反馈给客户端，客户端通过这个 IP 地址与 Web 服务器建立链接。

### DNS 查询方式

DNS 客户机可通过从以前查询获得的缓存信息就地应答查询，DNS 服务器可使用其自身的资源记录信息缓存来应答查询，也可代表请求客户机来查询或联系其他 DNS 服务器，以完全解析该名称，并随后将应答返回至客户机，这个过程称为 递归查询

客户机自己尝试联系其他的 DNS 服务器来解析名称，如果客户机这么做，它会使用基于服务器应答的独立和附加的查询，该过程称作迭代，即 DNS 服务器之间的交互查询就是 迭代查询

### DNS 优化

我们购买域名做域名解析时，有一个 TTL 值，这个值表示 DNS 服务器解析域名时记录在 DNS 服务器上的缓存时间。可以将其设置大一点，一般设置 TTL 3600 即可。
