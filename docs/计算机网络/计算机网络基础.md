## 什么是计算机网络

计算机网络主要是由一些通用的、可编程的硬件互连而成，通过这些硬件，可以传送不同类型的数据，并且可以支持广泛和日益增长的应用。

## 分类

### 按作用范围分

1. 广域网（WAN）
2. 城域网（MAN）
3. 局域网（LAN）

### 按使用者分

1. 公用网络
2. 专用网络

## OSI 七层模型

1. 应用层 为计算机用户提供接口和服务
2. 表示层 数据处理（编码解码、加密解密）
3. 会话层 管理（建立、维护、重连）通信会话
4. 传输层 管理端到端的通信连接
5. 网络层 数据路由（决定数据在网络的路径）
6. 数据链路层 管理相邻节点之间的数据通信
7. 物理层 数据通信的光电物理特性

## TCP/IP 四层模型

1. 应用层 （对应 OSI 的应用层、表示层、会话层） HTTP FTP SMTP POP3
2. 传输层 （对应 OSI 的传输层） TCP/UDP
3. 网络层 （对应 OSI 的网络层） IP
4. 网络接口层 （对应 OSI 的数据链路层、物理层）

## 物理层

### 物理层作用

1. 连接不同的物理设备
2. 传输比特流 在这一层，数据的单位称为比特（bit）。

### 信道

信道是往一个方向传送信息的媒体

一条通信电路包含一个接受信道和一个发送信道

#### 信道分类

1. 单工通信信道。只能往一个方向通信，没有反方向反馈的信道。比如电视、收音机
2. 半双工通信信道。双方都可以发送和接收信息，但是双方不能同时发送，也不能同时接收。
3. 全双工通信信道。双方都可以发送和接收信息，并且双方可以同时发送，也可以同时接收。

## 数据链路层

### 1、封装成帧

帧是数据链路层数据的基本单位

发送端在网络层的一段数据前后添加特定标记形成帧。

接收端根据前后特定标记识别出帧

#### 帧的组成

帧首部 + 帧数据 + 帧尾部

帧首部（SOH:00000001）

帧尾部（EOT:00000100）

#### 最大传输单元 MTU

数据链路层的数据帧不是无限大的

数据帧过大或过小都会影响传输的效率

以太网 MTU 一般为 1500 字节

路径 MTU 由链路中 MTU 的最小值决定

### 2、透明传输

控制字符在帧数据中，但是我们要当做不存在处理

#### 帧数据里面恰好有帧首部或帧尾部标记怎么办？

在控制字符前添加 ESC 转义字符。

如果需要传输 ESC 转义字符，我们只需要使用 ESC 转义 ESC。类似\

### 3、差错监测

物理层只管传输比特流，无法控制是否出错

数据链路层负责起检错监测的工作

数据链路层只负责数据的检测不进行纠正

#### 差错监测的方法

1. 奇偶检验码

在比特流尾部添加一位校验位。

- 比特流 00110010 1+1+1 = 3 是奇数所以在尾部添加 1
- 比特流 01110010 1+1+1+1 = 4 是偶数所以在尾部添加 0

这种局限性很明显，当出现两位一起变化的话监测不出来。

2. 循环冗余校验码 CRC

一种根据传输或保存的数据而产生固定位数校验码的方法

检测数据传输或者保存后可能出现的错误

生成的数字计算出来并且附加到数据后面

#### MAC 地址

把一台计算机的数据通过物理层和数据链路层发送给另外一台计算机，怎么标识对方以及怎么知道对方的地址呢？

唯一标示 MAC 地址 出现了。进入网络的每一台计算机，都会有网卡接口，每一个网卡都会有一个唯一的地址，就是所谓的 MAC 地址。MAC 地址共有 48 位，6 个字节。使用十六进制表示。

比如 30-B4-9E-ED-85-CA

#### 以太网协议

以太网是一种使用广泛的局域网技术

以太网是一种应用于数据链路层的协议

使用以太网可以完成相邻设备的数据帧传输

<table>
  <tr>
    <th>目的地址</th>
    <th>源地址</th>
    <th>类型</th>
    <th>帧数据</th>
    <th>CRC</th>
  </tr>
  <tr>
    <td>6</td>
    <td>6</td>
    <td>2</td>
    <td>46~1500</td>
    <td>4</td>
  </tr>
</table>

#### 广播

如果 计算机 A 知道 计算机 B 的 MAC 地址就能直接传送数据了但是如果计算机 A 不知道计算机 B 的 MAC 地址呢？

所以为了解决这个问题，广播 这个概念就出现了。在同一子网络，就是我们常说的局域网中，计算机通过广播来通信，即向同子网中全部计算机发送数据包，其它计算机根据数据包中接收者的 MAC 地址 来判断是否接收数据包。会取出数据包中的 MAC 地址 与自身的 MAC 地址 对比，如相同就接收这个数据包，否则就丢弃这个数据包 ( 丢包 )，这种方式我们称之为 广播。

## 网路层

在这一层数据的单位被称为数据包。

### 虚拟互连网络

实际的计算机网络是错综复杂的

物理设备通过使用 IP 协议，屏蔽了物理网络之间的差异

当网络中的主机使用 IP 协议连接时，则无需关注网络细节

### ip 协议

IP 协议使得复杂的实际网络变为一个虚拟互连的网络

Ip 协议使得网络层可以屏蔽底层细节而专注网络层的数据转发

IP 协议解决了在虚拟网络中数据报传输路径的问题

IP 地址长度为 32 位，常分成 4 个 8 位，即 4 个字节。

ip 地址常使用点分十进制来表示（0~255.0~255.0~255.0~255）

#### ip 地址有 5 种

IP 地址 分为两部分，前面一部分代表网络，后面一部分代表主机，但是网络部分和主机部分所占用的二级制位数是不固定的。

- A 类：1.0.0.0~126.255.255.255
- B 类：128.0.0.0~191.255.255.255
- C 类：192.0.0.0~223.255.255.255
- D 类：224.0.0.0~239.255.255.255 用于组播
- E 类：240.0.0.0~254.255.255.255 用于科研
- 127.0.0.0~127.255.255.255 用于环回测试

### 路由表

<table>
  <tr>
    <th>目的IP地址</th>
    <th>下一跳IP地址</th>
  </tr>
  <tr>
    <td>ip1</td>
    <td>ip2</td>
  </tr>
</table>

计算机或者路由器都拥有路由表

### IP 协议的转发流程

1. A 发出目的地为 C 的 IP 数据报，查询路由表发现下一跳为 E
2. A 将数据报发送给 E
3. E 查询路由表表发现下一跳为 F，将数据报发送给 F
4. F 查询路由表发现目的地 C 直接连接，将数据报发送给 C

### ARP(地址转换协议) 协议的工作原理？

MAC 地址一般来讲是不会变的，设备在生产时就被“烙”上了 唯一的标识，这个 唯一的标识 就是 MAC 地址。

网络层的 ARP 协议完成了 IP 地址与 MAC 地址的映射。

1. 首先，每台主机都会在自己的 ARP 缓冲区中建立一个 ARP 列表，以表示 IP 地址和 MAC 地址的对应关系。
2. 当源主机需要将一个数据包要发送到目的主机时，会首先检查自己 ARP 列表中是否存在该 IP 地址对应的 MAC 地址。
3. 如果有，就直接将数据包发送到这个 MAC 地址。
4. 如果没有，就向本地网段发起一个 ARP 请求的广播包，查询此目的主机对应的 MAC 地址。此 ARP 请求数据包里包括源主机的 IP 地址、硬件地址、以及目的主机的 IP 地址。网络中所有的主机收到这个 ARP 请求后，会检查数据包中的目的 IP 是否和自己的 IP 地址一致。如果不相同就忽略此数据包；如果相同，该主机首先将发送端的 MAC 地址和 IP 地址添加到自己的 ARP 列表中，如果 ARP 表中已经存在该 IP 的信息，则将其覆盖，然后给源主机发送一个 ARP 响应数据包，告诉对方自己是它需要查找的 MAC 地址。
5. 源主机收到这个 ARP 响应数据包后，将得到的目的主机的 IP 地址和 MAC 地址添加到自己的 ARP 列表中，并利用此信息开始数据的传输。
6. 如果源主机一直没有收到 ARP 响应数据包，表示 ARP 查询失败。

我们使用`arp -a`查看 arp 缓存列表

### RARP(逆地址解析协议)

通过 MAC 地址找 IP 地址
