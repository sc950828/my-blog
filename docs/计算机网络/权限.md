### 认证（Authentication）

认证涉及一方应用和一方用户，用于描述用户在该应用下的身份。认证可以简单理解为登录，以此确认你是一个合法的用户。比如说掘金必须要登录才能点赞、收藏。

### 授权（Authorisation）

授权涉及两方应用和一方用户，用于描述第三方应用有哪些操作权限。

### 认证授权例子

只认证不授权

上面提到的使用掘金账号登录掘金就是只认证不授权的场景，此时掘金只知道你是哪个用户，但是不涉及到授权的操作。

既认证又授权

同样是登录掘金，我们可以不使用在掘金注册的账号和密码登录，而选择第三方应用登录，比如说 github 账号。此时会弹出 github 的登录页面，如果你在此页面输入账号和密码进行登录，则相当于默认授权给掘金获取你的 github 的头像和账号名。在这个过程中即完成了认证（合法用户）又完成了授权（你允许掘金从 github 获取你的信息）。

不认证只授权

以某外卖小程序为例，在你第一次进入外卖小程序的时候小程序会弹框请求获取你的个人信息，此时相当于上面提到的既认证又授权。你同意以后就相当于使用微信账号登录，但是此时外卖小程序获取到的你的信息不包括你的手机号。当你要下单点击提交的时候，小程序再次发起请求，要获取你微信绑定的手机号，此时发生的动作就是不认证只授权。

### HTTP Basic Authentication

这种授权方式是浏览器遵守 http 协议实现的基本授权方式

### session cookie

用户先使用用户名和密码登录，登录完成后后端将用户信息存在 session 中，把 sessionId 写到前端的 cookie 中，后面每次请求都会带着 cookie 去后端，只要后端判断 sessionId 没问题且没过期就不需要再次登录。

问题

- cookie 安全性问题，攻击者可以通过 xss 获取 cookie 中的 sessinId，使用 httpOnly 在一定程度上提高安全性
- cookie 不能跨域传输
- session 存储在服务器中，所以 session 过多会耗费较大服务器资源
- 分布式下 session 共享问题

### token 常用的是 jwt

与上面的 Session-Cookie 机制不同的地方在于，基于 token 的用户认证是一种服务端无状态的认证方式，服务端可以不用存放 token 数据，但是服务器可以验证 token 的合法性和有效性。使用 token 进行认证的方式这里主要介绍两种：SAML 和 JWT.

SAML 的流程如下：

- 未登录的用户通过浏览器访问资源网站（Service Provider，简称 SP）
- SP 发现用户未登录，将页面重定向至 IdP（Identity Provider）
- IdP 验证请求无误后，提供表单让用户进行登录
- 用户登录成功后，IdP 生成并发送 SAML token (一个很大的 XML 对象) 给 SP
- SP 对 token 进行验证，解析获取用户信息，允许用户访问相关资源

1. SP 是如何验证 token 的合法性？比如是否有可能 token 在 IDP 到 SP 的过程中被人劫持并修改了内容？

答案是：没有可能。因为 IDP 返回给 SP 的 token 使用 IDP 的私钥进行了签名，而通过私钥签名后的信息可以通过对应的公钥进行验证。

2. SP 如何判断 token 是否过期？

SAML token 携带了 token 过期时间的信息。

3. 生成的 SAML token 是托管在 SP 还是前端？

如果是托管在 SP，那么又要引入 session 机制，如果托管在前端，那么前端需要存储并且每次传递 SAML token，但是 SAML token 大小又比较大，耗费传输资源。

答案是：都可以。放在前端的话需要前端通过单独的 ajax 请求获取 token 并存储在 localStorage 或者其他的本地存储中。如果是托管在 SP，那么就像上面说的，引入 session，前端只掌握 sessionId，这样的话 token 机制其实就退化成了上面提到的 session-cookie 机制。

JWT json web token

JWT 生成的 token 是通过用户信息和过期时间和私钥加密生成的一个字符串。

JWT 就是一种在用户登录后生成 token 并把 token 放在前端，后端不需要维护用户的状态信息但是可以验证 token 有效性的认证及状态管理方式。

Token 的特点

- 服务器端不需要存放 Token，所以不会对服务器端造成压力，即使是服务器集群，也不需要增加维护成本。
- Token 可以存放在前端任何地方，可以不用保存在 Cookie 中，提升了页面的安全性。
- Token 下发之后，只要在生效时间之内，就一直有效，但是如果服务器端想收回此 Token 的权限，并不容易。

### oauth 第三方登录

- 在授权页面登录
- 登录成功后得到 code
- 第三方服务器通过 code 向授权服务器发请求得到 access token
- 授权服务器返回 access token
- 第三方服务器通过 token 向授权服务器拿用户信息
- 授权服务器返回用户信息给第三方服务器

微信授权例子

- 首先，a.com 的运营者需要在微信开放平台注册账号，并向微信申请使用微信登录功能。
- 申请成功后，得到申请的 appid、appsecret。
- 用户在 a.com 上选择使用微信登录。
- 这时会跳转微信的 OAuth 授权登录，并带上 a.com 的回调地址。
- 用户输入微信账号和密码，登录成功后，需要选择具体的授权范围，如：授权用户的头像、昵称等。
- 授权之后，微信会根据重定向到并携带一个 code 比如 a.com?code=123 ，这时带上了一个临时票据 code。
- 获取 code 之后， a.com 会拿着 code 、appid、appsecret，向微信服务器申请 token，验证成功后，微信会下发一个 token。
- 有了 token 之后， a.com 就可以凭借 token 向微信服务器请求拿到对应的微信用户头像，用户昵称等信息了。
- a.com 提示用户登录成功，并将登录状态写入 Cooke，以作为后续访问的凭证。

### 本人 vue 项目中登录验证

使用 JWT token，客户端存储在 localStroage 中，每次页面跳转在全局守卫 bedoreEach 中判断有无 token，没有直接跳登录页面，有进入下一步。注销的时候清除 localStroage

### 单点登录 SSO

什么是单点登录？

单点登录指的是在公司内部搭建一个公共的认证中心，公司下的所有产品的登录都可以在认证中心里完成，一个产品在认证中心登录后，再去访问另一个产品，可以不用再次登录，即可获取登录状态。
