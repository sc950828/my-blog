### 运行环境方面

H5 的宿主环境是浏览器，只要有浏览器，就可以使用，包括 APP 中的 web-view 组件，以及小程序提供的 web-view 组件

小程序就不一样了，它运行于特定的移动软件平台 (Wechat / 支付宝 / 字节跳动 / 百度 / QQ 等)。它是基于浏览器内核重构的内置解析器，它并不是一个完整的浏览器，官方文档中重点强调了脚本内无法使用浏览器中常用的 window 对象和 document 对象，就是没有 DOM 和 BOM 的相关的 API。

### 运行机制方面

H5 的运行就是一个网页的运行

小程序

- 如果用户已经打开过某小程序，在一定时间内再次打开该小程序，此时无需重新启动，只需将后台态的小程序切换到前台，整个过程就是所谓的 热启动。

- 如果用户首次打开或小程序被微信主动销毁后再次打开的情况，此时小程序需要重新加载启动，就是 冷启动

- 当小程序进入后台一定时间，或系统资源占用过高，或者是你手动销毁，才算真正的销毁

### 系统权限方面

H5 最被诟病的地方在哪？系统权限不够，比如网络通信状态、数据缓存能力、通讯录、或调用硬件的，如蓝牙功能等等一些 APP 有的功能，H5 就没有这些系统权限，因为它重度依赖浏览器能力。

小程序权限与客户端的系统权限都以无缝衔接，权限更广。

### 开发语言

H5 开发大家都知道，标准的 HTML、CSS、JavaScript ，万变不离其三剑客。

小程序不同， (Wechat / 支付宝 / 字节跳动 / 百度 / QQ 等)不同的小程序都有自己定义独特的语言。比如最常用的微信小程序，就是自定义的 WXML、WXSS。

### 更新方面

H5 的话想怎么更新就怎么更新，更新完用户刷新浏览器就能看到效果

小程序的话需要发布审核。小程序每次 冷启动 时，都会检查有无更新版本，如果发现有新版本，会异步下载新版本代码包，并同时用客户端本地包进行启动，所以新版本的小程序需要等下一次 冷启动 才会应用上。如果需要马上应用最新版本，可以使用 wx.getUpdateManager API 进行处理。

```js
const updateManager = wx.getUpdateManager();

updateManager.onCheckForUpdate(function (res) {
  // 请求完新版本信息的回调
  console.log(res.hasUpdate);
});

updateManager.onUpdateReady(function () {
  wx.showModal({
    title: "更新提示",
    content: "新版本已经准备好，是否重启应用？",
    success(res) {
      if (res.confirm) {
        // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启
        updateManager.applyUpdate();
      }
    }
  });
});

updateManager.onUpdateFailed(function () {
  // 新版本下载失败
});
```

### 渲染机制

H5 就是 web 渲染，浏览器渲染。渲染和 js 引擎线程是互斥的，同一时间只能运行一个。

小程序的渲染层和逻辑层分别由 2 个线程管理。其中 WXML 模板和 WXSS 样式工作在渲染层，JS 脚本工作在逻辑层。

- 渲染层：界面渲染相关的任务全都在 WebView 线程里执行，一个小程序存在多个界面，所以渲染层存在多个 WebView 线程

- 逻辑层：一个单独的线程执行 JavaScript，在这个环境下执行的都是有关小程序业务逻辑的代码，就是通过图中的 JsCore 线程来运行 JS 脚本

- 这两个线程都会经过微信客户端( Native )中的 WeixinJsBridage 进行中转通信，逻辑层把数据变化通知到视图层，触发视图层页面更新，视图层把触发的事件通知到逻辑层进行业务处理

- 虽然小程序是通过 Native 原生渲染的，但是小程序也支持 web 渲染，就是 web-view 组件，在 web-view 中加载 H5 页面，而我们开发小程序时，通常会使用 hybrid 的方式，根据具体情况选择部分功能用小程序原生的代码来开发，部分功能通过 web-view 加载 H5 页面来实现，Native 与 Web 渲染 混合使用，实现项目最优解。

### 兼容处理

微信版本对应有基础库版本。基础库版本越高功能越多，但是低版本的微信客户端可能会不支持。所以需要兼容。

第一种 开发者可以在小程序中通过调用 wx.getSystemInfo 或者 wx.getSystemInfoSync 获取到当前小程序运行的基础库的版本号。通过版本号比较的方式进行运行低版本兼容逻辑。`const version = wx.getSystemInfoSync().SDKVersion`

第二种 Api 存在判断 对于新增的 API，可以通过判断该 API 是否存在来判断是否支持用户使用的基础库版本。

第三种 使用 canIUse 来判断 `wx.canIUse('showModal.success.cancel')`

为便于开发者解决低版本基础库无法兼容小程序的新功能的问题，开发者可设置小程序最低基础库版本要求。设置后，若用户基础库版本低于设置值，则无法正常打开小程序，并提示用户更新客户端版本。
