### meta 对于移动端的一些特殊属性，可根据需要自行设置

```html
<meta name="screen-orientation" content="portrait" /> //Android 禁止屏幕旋转
<meta name="full-screen" content="yes" /> //全屏显示
<meta
  name="browsermode"
  content="application"
/>//UC应用模式，使用了application这种应用模式后，页面将默认全屏，禁止长按菜单，禁止收拾，标准排版，以及强制图片示。
<meta name="x5-orientation" content="portrait" /> //QQ强制竖屏
<meta name="x5-fullscreen" content="true" /> //QQ强制全屏
<meta name="x5-page-mode" content="app" /> //QQ应用模式
```

### 电话号码识别

在 iOS Safari （其他浏览器和 Android 均不会）上会对那些看起来像是电话号码的数字处理为电话链接，比如：

- 7 位数字，形如：1234567
- 带括号及加号的数字，形如：(+86)123456789
- 双连接线的数字，形如：00-00-00111
- 11 位数字，形如：13800138000

```html
关闭识别
<meta name="format-detection" content="telephone=no" />
开启识别
<a href="tel:123456">123456</a>
```

### 邮箱识别（Android）

```html
关闭识别
<meta name="format-detection" content="email=no" />
开启识别
<a href="mailto:sc950824@gmail.com">sc950824@gmail.com</a>
```

### 禁止用户选择页面中的文字或者图片

这样设置微信和百度浏览器图片还是可以选择

```css
.div {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
```

### 在 iOS 上，输入框默认有内部阴影,以这样关闭：

```css
input {
  -webkit-appearance: none;
}
```

### ios input 默认有 padding 和 border-radius

input 默认有 padding 和 border-radius 这是和安卓的区别 需要额外清除

### 用户设置字号放大或者缩小导致页面布局错误

设置字体禁止缩放

```css
body {
  -webkit-text-size-adjust: 100% !important;
  -moz-text-size-adjust: 100% !important;
  text-size-adjust: 100% !important;
}
```

### 系统中按钮或输入框或者 a 标签元素被点击时产生边框

系统中元素被点击时会出现一个边框或者半透明灰色遮罩, 不同生产商定义出来额效果不一样。
下面的方法其实就是把点击效果都去掉了。

```css
a,
button,
input,
textarea {
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  -webkit-user-modify: read-write-plaintext-only;
}
```

### 画一条 0.5 px 的线

- 主要是跟一个东西有关，DPR(devicePixelRatio) 设备像素比，它是默认缩放为 100%的情况下，设备像素和 独立像素的比值。目前主流的屏幕 DPR=2（iPhone 8）,或者 3（iPhone 8 Plus）。拿 2 倍屏来说，设备的物理像素要实现 1 像素，而 DPR=2，所以 css 像素只能是 0.5。scaleY(0.5)。当 dpr 是 3 的话就 scaleY(0.333)。
- 方法
  - 采用 transform: scaleY()或者 scaleX() 的方式。根据 dpr 来设置缩写比。
  - 采用 meta viewport 的方式。当 dpr 是 2 的时候，可以使用该方法的 initial-scale 初始缩放 0.5 倍。当 dpr 是 3 的时候 initial-scale 初始缩放 0.33 倍。根据 dpr 来设置缩写比。
  - 使用 border-image 或者 box-shadow

### 移动端 click 屏幕产生 200-300 ms 的延迟响应 点击穿透问题

移动端点击有 300ms 的延迟是因为移动端会有双击缩放的这个操作，因此浏览器在 click 之后要等待 300ms，看用户有没有下一次点击，来判断这次操作是不是双击。

解决方案：

- 通过 meta 标签禁用网页的缩放。`<meta name="viewport" content="user-scalable=no">`
- touch-action 这个 CSS 属性值设置为 touch-action: none，那么表示在该元素上的操作不会触发用户代理的任何默认行为，就无需进行 300ms 的延迟判断。现在除了 IE，其他大部分浏览器都还不支持指针事件。需要使用 polyfill
- fastclick 可以解决在手机上点击事件的 300ms 延迟。FastClick 的实现原理是在检测到 touchend 事件的时候，会通过 DOM 自定义事件立即出发模拟一个 click 事件，并把浏览器在 300ms 之后的 click 事件阻止掉。
- zepto 的 touch 模块，tap 事件也是为了解决在 click 的延迟问题

触摸事件的响应顺序：

- ontouchstart
- ontouchmove
- ontouchend
- onclick

移动端点透问题

- 当点击绝对定位元素的时候，下面的 a 元素虽然被遮盖但是也会进行页面跳转。
- 产生原因是绝对定位元素使用了 touch touch 事件，该事件早于 click 事件 300ms，所以在该事件中隐藏该元素的时候会把 click 事件作用到该元素的下一级元素。
- 解决办法
  - 都使用 click 事件
  - 在 touchstart touchend 事件最后阻止默认事件。

### audio 和 video 在 ios 和 andriod 中自动播放

这个不是 bug，由于自动播放网页中的音频或视频，会给用户带来一些困扰或者不必要的流量消耗，所以苹果系统和安卓系统通常都会禁止自动播放和使用 JS 的触发播放，必须由用户来触发才可以播放。加入自动触发播放的代码

```js
//获取元素 执行play()方法
$("html").one("touchstart", function() {
  audio.play();
});
```

### 如何禁止保存或拷贝图像

```css
img {
  -webkit-touch-callout: none;
}
```

### iOS 上拉边界下拉出现空白

手指按住屏幕下拉，屏幕顶部会多出一块白色区域。手指按住屏幕上拉，底部多出一块白色区域。
在 iOS 中，手指按住屏幕上下拖动，会触发 touchmove 事件。这个事件触发的对象是整个 webview 容器，容器自然会被拖动，剩下的部分会成空白。
解决方案

```js
// 使用下面的方法的缺点是容器不能滚动了
document.body.addEventListener(
  "touchmove",
  function(e) {
    if (e._isScroller) return; // 让需要滑动的地方滑动，不需要滑动的地方禁止滑动。
    // 阻止默认事件
    e.preventDefault();
  },
  {
    passive: false, // 当置为true时，表示 listener 永远不会调用 preventDefault()。如果 listener 仍然调用了这个函数，客户端将会忽略它并抛出一个控制台警告
  }
);
```

### ios 日期转换 NAN 的问题

将日期字符串的格式符号替换成'/'
这个问题现在没有了，但我在做宝贝王项目的时候碰到了。

time.replace(/-/g, '/')

### ios 键盘弹起挡住原来的视图

- 可以通过监听移动端软键盘弹起时触发的 resize 事件。在该事件里通过调用 Element.scrollIntoView 或者 Element.scrollIntoViewIfNeeded 方法进行移动。
- Element.scrollIntoView 或者 Element.scrollIntoViewIfNeeded 方法用来将不在浏览器窗口的可见区域内的元素滚动到浏览器窗口的可见区域。 如果该元素已经在浏览器窗口的可见区域内，则不会发生滚动。

```js
// scrollIntoView
// true，元素的顶端将和其所在滚动区的可视区域的顶端对齐
// false，元素的底端将和其所在滚动区的可视区域的底端对齐
// object 类型
{
  behavior: "auto" | "instant" | "smooth",
  block: "start" | "end",
}
// 1.如果是一个boolean，true 相当于{block: "start"}，false 相当于{block: "end"}
// 2.behavior这个选项决定页面是如何滚动的，实测auto与instant都是瞬间跳到相应的位置，而smooth就是有动画的过程
```

```js
// scrollIntoViewIfNeeded
// scrollIntoViewIfNeeded是比较懒散的，如果元素在可视区域，那么调用它的时候，页面是不会发生滚动的。
// 其次是scrollIntoViewIfNeeded只有Boolean型参数，也就是说，都是瞬间滚动，没有动画的可能了。
// true为默认值，但不是滚动到顶部，而是让元素在可视区域中居中对齐；
// false时元素可能顶部或底部对齐，视乎元素靠哪边更近
```

```js
//方法1
window.addEventListener("resize", function() {
  if (
    document.activeElement.tagName === "INPUT" ||
    document.activeElement.tagName === "TEXTAREA"
  ) {
    window.setTimeout(function() {
      if ("scrollIntoView" in document.activeElement) {
        document.activeElement.scrollIntoView(false);
      } else {
        document.activeElement.scrollIntoViewIfNeeded(false);
      }
    }, 0);
  }
});
```

```js
//方法2
const input = document.getElementsByTagName("input")[0];
let scrollTop = 0;

input.addEventListener("focus", function() {
  // 记住当前顶部距离
  scrollTop = document.body.scrollTop;
  // 滚动到最底部
  document.body.scrollTop = document.body.scrollHeight;
});
input.addEventListener("blur", function() {
  // 滚到之前的位置
  document.body.scrollTop = scrollTop;
});
```

### ios 键盘收起时页面没用回落，底部会留白

通过监听输入框失去焦点事件 blur 或者 focusout，滚动到顶部。

```js
window.addEventListener("focusout", function() {
  window.scrollTo(0, 0);
});
```

### ios 下 软键盘唤起后 fixed 失效的原因

软键盘唤起后，页面的 fixed 元素将失效，变成了 absolute，所以当页面超过一屏且滚动时，失效的 fixed 元素就会跟随滚动了。不仅限于 type=text 的输入框，凡是软键盘（比如时间日期选择、select 选择等等）被唤起，都会遇到同样地问题。
解决方法: 不让页面滚动，而是让主体部分自己滚动,主体部分高度设为 100%，overflow:scroll

```html
<body>
  <div class='warper'>
    <div class='main'></div>
  <div>
  <div class="fix-bottom"></div>
</body>
```

```css
.warper {
  position: absolute;
  width: 100%;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  overflow-y: scroll;
  -webkit-overflow-scrolling: touch; /* 解决ios滑动不流畅问题 */
}
.fix-bottom {
  position: fixed;
  bottom: 0;
  width: 100%;
}
```

### ios 滑动不流畅

在滚动容器上设置`-webkit-overflow-scrolling: touch` 默认值是 auto

```css
.wrapper {
  -webkit-overflow-scrolling: touch; /* 当手指从触摸屏上移开，会保持一段时间的滚动 */
  -webkit-overflow-scrolling: auto; /* 当手指从触摸屏上移开，滚动会立即停止 */
}
```

### 适配 iphonex 等刘海屏

1.viewport-fit

viewport-fit 是专门为了适配 iPhoneX 而诞生的一个属性，它用于限制网页如何在安全区域内进行展示。

    contain: 可视窗口完全包含网页内容
    cover：网页内容完全覆盖可视窗口
    默认情况下或者设置为 auto 和 contain 效果相同。

2.env、constant

我们需要将顶部和底部合理的摆放在安全区域内，iOS11 新增了两个 CSS 函数 env、constant，用于设定安全区域与边界的距离。注意：我们必须指定 viweport-fit 后才能使用这两个函数。`<meta name="viewport" content="viewport-fit=cover">`constant 在 iOS < 11.2 的版本中生效，env 在 iOS >= 11.2 的版本中生效

    函数内部可以是四个常量：
      safe-area-inset-left：安全区域距离左边边界距离
      safe-area-inset-right：安全区域距离右边边界距离
      safe-area-inset-top：安全区域距离顶部边界距离
      safe-area-inset-bottom：安全区域距离底部边界距离

    {
      padding-bottom: constant(safe-area-inset-bottom);
      padding-bottom: env(safe-area-inset-bottom);
    }

### 横屏竖屏判断

1.js 检测当前是横屏还是竖屏

```js
window.addEventListener("resize", () => {
  if (window.orientation === 180 || window.orientation === 0) {
    // 正常方向或屏幕旋转180度
    console.log("竖屏");
  }
  if (window.orientation === 90 || window.orientation === -90) {
    // 屏幕顺时钟旋转90度或屏幕逆时针旋转90度
    console.log("横屏");
  }
});
```

2.css 检测当前是横屏还是竖屏

```css
@media screen and (orientation: portrait) {
  /*竖屏...*/
}
@media screen and (orientation: landscape) {
  /*横屏...*/
}
```

### 图片模糊问题

在高清屏幕上图片的一个像素点可能由多个 css 像素点来展示，所以会模糊。

解决方案

1.针对不同 DPR 的屏幕，我们使用不同的倍图。有两倍图三倍图等等。只适用于背景图。

```css
.avatar {
  background-image: url(conardLi_1x.png);
}
@media only screen and (-webkit-min-device-pixel-ratio: 2) {
  .avatar {
    background-image: url(conardLi_2x.png);
  }
}
@media only screen and (-webkit-min-device-pixel-ratio: 3) {
  .avatar {
    background-image: url(conardLi_3x.png);
  }
}
```

2.使用 -webkit-image-set 只适用于背景图

```css
.div2 {
  background-image: -webkit-image-set(
    url("./images/user.png") 3x,
    url("./images/banner.png") 2x,
    url("./images/avatar.jpg") 1x
  );
  background-size: cover;
}
```

3.使用 srcset
使用 img 标签的 srcset 属性，浏览器会自动根据像素密度匹配最佳显示图片：

对于`<img>`，我们还可以使用的一组很好的特性 object-fit 和 object-position。它们可以控制`<img>`的大小和定位，就像 CSS 背景图像。

```html
<img
  src="./images/avatar.jpg"
  srcset="./images/banner.png 2x, ./images/user.png 3x"
  alt="img"
  width="100"
  height="100"
/>
```

4.使用 JavaScript 拼接图片 url
使用 window.devicePixelRatio 获取设备像素比，遍历所有图片，替换图片地址：

```js
const dpr = window.devicePixelRatio;
const images = document.querySelectorAll("img");
images.forEach((img) => {
  img.src.replace(".", `@${dpr}x.`);
});
```

5.使用 svg
SVG 的全称是可缩放矢量图（Scalable Vector Graphics）。不同于位图的基于像素，SVG 则是属于对图像的形状描述，所以它本质上是文本文件，体积较小，且不管放大多少倍都不会失真。

### ios 键盘字母输入，默认首字母大写

`<input type="text" autocapitalize="off" />`

### ios 系统中，中文输入法输入英文时，字母之间可能会出现一个六分之一空格

- 监听 oninput 事件 在事件里面把空格替换掉。
- e.target.value = e.target.value.replace(/\u2006/g, '');

### 页面放大或缩小

HTML 本身会产生放大或缩小的行为，比如在 PC 浏览器上，可以自由控制页面的放大缩小。但是在移动端，我们是不需要这个行为的。所以，我们需要禁止该不确定性行为，来提升用户体验。

我们可以通过`user-scalable=no`属性设置禁止用户缩放

```html
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, minimum-scale=1.0 maximum-scale=1.0, user-scalable=no"
/>
```

### 微信公众号分享问题

在微信公众号 H5 开发中，页面内部点击分享按钮调用 SDK，方法不生效。

因为页面内部点击分享按钮无法直接调用，而分享功能需要点击右上角更多来操作。然后用户可能不知道通过右上角小标里面的功能分享。又想引导用户分享，这时应该怎么做呢？技术无法实现的，从产品出发。

解决方法：添加一层蒙层，做分享引导。

### 移动端和 pc 端互跳

如为双端页面，需要自动判断跳转，PC 访问移动端页面，跳转到对应的 PC 专题上，反之亦然。

PC 端添加：

```js
(function() {
  if (/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)) {
    window.location.href = "移动端端专题地址" + location.search;
  }
})();
```

移动端添加：

```js
(function() {
  if (!/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)) {
    window.location.href = "PC端专题地址" + location.search;
  }
})();
```

解决方案还可以是在 nginx 配置
