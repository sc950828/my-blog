### docker file

Dockerfile 是 Docker 中用于定义镜像自动化构建流程的配置文件，在 Dockerfile 中，包含了构建镜像过程中需要执行的命令和其他操作。通过 Dockerfile 我们可以更加清晰、明确的给定 Docker 镜像的制作过程，而由于其仅是简单、小体积的文件，在网络等其他介质中传递的速度极快，能够更快的帮助我们实现容器迁移和集群部署。

Dockerfile 的内容很简单，主要以两种形式呈现，一种是注释行，另一种是指令行。

### docker file 优势

相对于之前我们介绍的提交容器修改，再进行镜像迁移的方式相比，使用 Dockerfile 进行这项工作有很多优势，我总结了几项尤为突出的。

1. Dockerfile 的体积远小于镜像包，更容易进行快速迁移和部署。
2. 环境构建流程记录了 Dockerfile 中，能够直观的看到镜像构建的顺序和逻辑。
3. 使用 Dockerfile 来构建镜像能够更轻松的实现自动部署等自动化流程。
4. 在修改环境搭建细节时，修改 Dockerfile 文件要比从新提交镜像来的轻松、简单。

### docker 指令

如果进行细分，我们可以将 Dockerfile 的指令简单分为五大类。

1. 基础指令：用于定义新镜像的基础和性质。
2. 控制指令：是指导镜像构建的核心部分，用于描述镜像在构建过程中需要执行的命令。
3. 引入指令：用于将外部文件直接引入到构建镜像内部。
4. 执行指令：能够为基于镜像所创建的容器，指定在启动时需要执行的脚本或命令。
5. 配置指令：对镜像以及基于镜像所创建的容器，可以通过配置指令对其网络、用户等内容进行配置。

#### FROM

在 Dockerfile 里，我们可以通过 FROM 指令指定一个基础镜像，接下来所有的指令都是基于这个镜像所展开的。在镜像构建的过程中，Docker 也会先获取到这个给出的基础镜像，再从这个镜像上进行构建操作。

```
FROM <image> [AS <name>]
FROM <image>[:<tag>] [AS <name>]
FROM <image>[@<digest>] [AS <name>]
```

#### RUN

镜像的构建虽然是按照指令执行的，但指令只是引导，最终大部分内容还是控制台中对程序发出的命令，而 RUN 指令就是用于向控制台发送命令的指令。

在 RUN 指令之后，我们直接拼接上需要执行的命令，在构建时，Docker 就会执行这些命令，并将它们对文件系统的修改记录下来，形成镜像的变化。

```
RUN <command>
RUN ["executable", "param1", "param2"]
```

RUN 指令是支持 \ 换行的，如果单行的长度过长，建议对内容进行切割，方便阅读。而事实上，我们会经常看到 \ 分割的命令，例如在上面我们贴出的 Redis 镜像的 Dockerfile 里。
