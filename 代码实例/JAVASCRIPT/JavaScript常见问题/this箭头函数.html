<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>this箭头函数</title>
  </head>
  <body>
    <div class="father">father</div>
    <script>
      // 作为普通函数
      // 在普通函数中，箭头函数被设置为全局对象：无论是否严格模式
      var globalObject = window;
      var foo = () => this;
      var foo2 = () => {
        "use strict";
        return this;
      };
      console.log(foo() === globalObject); // true
      console.log(foo2() === globalObject); // true

      //箭头函数没有自己的this，而是使用箭头函数所在的作用域的this
      // 箭头函数作为对象的方法使用
      // 箭头函数作为对象的方法使用，指向全局window对象；而普通函数作为对象的方法使用，则指向调用的对象。
      var obj = {
        i: 10,
        b: () => console.log(this.i, this),
        c: function () {
          console.log(this.i, this);
        },
      };
      obj.b(); // undefined window{...}
      obj.c(); // 10 Object {...}

      // setTimeout setInterval
      setTimeout(() => {
        // 始终指向window
        console.log("箭头函数在setTimeout中的this", this);
      }, 100);

      // 事件对象
      document
        .getElementsByClassName("father")[0]
        .addEventListener("click", (e) => {
          console.log(this); // 始终指向window
        });

      //箭头函数在函数内部，以非方法的方法使用
      function Person1(age) {
        this.age = age;
        setInterval(() => {
          console.log(this); // 指向p1
        }, 1000);
      }
      //普通函数作为内部函数
      function Person2() {
        this.age = 0;
        setInterval(function () {
          console.log(this); // 指向window
        }, 1000);
      }
      // var p1 = new Person1(10);
      // var p2 = new Person2();

      // 箭头函数中，call()、apply()、bind()方法无效
      var say = () => {
        console.log(this);
      };
      say();
      say.call({ name: "randy" }); // 无效

      // 箭头函数不能用作构造函数
      var Father = (name) => {
        this.name = name;
      };
      // console.log(new Father("randy")); //报错 箭头函数不能作为构造函数

      // 箭头函数没有arguments对象 如果需要 需要使用...args
      var hello = function (name, age) {
        console.log(arguments);
        console.log("arguments[0]", arguments[0]);
        console.log("arguments[1]", arguments[1]);
      };
      hello("randy", 24); //Arguments(2) [0: "randy", 1: 24]

      var hello2 = (name, age) => {
        console.log(arguments);
      };
      // hello2("randy", 24) // Uncaught ReferenceError: arguments is not defined

      var hello3 = (...args) => {
        console.log(args);
      };
      hello3("randy", 24); // ["randy", 24]
    </script>
  </body>
</html>
